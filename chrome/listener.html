<html>
 <head>
  <title>SemSurf - Future of Websurfing</title>
  <script type="text/javascript" src="jquery-1.5.1.js"></script>
  <script type="text/javascript" src="jquery.json-2.3.min.js"></script>
  <script type="text/javascript">
	
		chrome.extension.onRequest.addListener(function(request) {
		    if(request.do == "save") {
		        localStorage.setItem(request.key,$.toJSON( request.value ));
		    }
		    if(request.do == "find_all") {
		        $.ajax({
						    url: 'http://localhost:8080/server/service/findAll',
						    type: 'GET',
						    success: function(m) { alert($.toJSON(m)); },
						    error: function(m) { alert($.toJSON(m)); }
						});
		    } 
		    if(request.do == "test") {
		        $.ajax({
						    url: 'http://localhost:8080/server/service/test',
						    type: 'GET',
						    success: function(m) { alert($.toJSON(m)); },
						    error: function(m) { alert($.toJSON(m)); }
						});
		    } 
		    if(request.do == "validate") {
		        var i=0;
						for (i=0; i<localStorage.length; i++) {
							var item = localStorage.getItem(localStorage.key(i));
							$.ajax({
						    url: 'http://localhost:8080/server/service/vpost',
						    type: 'POST',
						    data: item,
						    contentType: "application/json; charset=utf-8",
						    success: function(m) { alert($.toJSON(m)); },
						    error: function(m) { alert($.toJSON(m)); }
							});
						}
		    } 
		    if(request.do == "send") {
		        var i=0;
						for (i=0; i<localStorage.length; i++) {
							var item = localStorage.getItem(localStorage.key(i));
							$.ajax({
						    url: 'http://localhost:8080/server/service/post',
						    type: 'POST',
						    data: item,
						    contentType: "application/json; charset=utf-8",
						    success: function(m) {  },
						    error: function(m) { alert($.toJSON(m)); }
							});
							localStorage.removeItem(localStorage.key(i));
						}
		    } 
		    if(request.do == "purge") {
		        var i=0;
						for (i=0; i<localStorage.length; i++) {
							localStorage.removeItem(localStorage.key(i));
						}
		    } 
		    if(request.do == "audit") {
		        var i=0;
						for (i=0; i<localStorage.length; i++) {
							alert(localStorage.getItem(localStorage.key(i)));
						}
		    } 
		});
  </script>
 </head>
 
</html>

