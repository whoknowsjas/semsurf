<html>
 <head>
  <script type="text/javascript" src="jquery-1.5.1.js"></script>
  <script type="text/javascript" src="jquery.json-2.3.min.js"></script>
  <script type="text/javascript">
	
		chrome.extension.onRequest.addListener(function(request) {
			var sUrl = 'http://localhost:8080/server/service';
		    if(request.do == "save") {
		        localStorage.setItem(request.key,$.toJSON( request.value ));
		    } 
		    if(request.do == "test") {
		        $.ajax({
				    url: sUrl+'/test',
				    type: 'GET',
				    success: function(m) { alert($.toJSON(m)); },
				    error: function(m) { alert($.toJSON(m)); }
				});
		    } 
		    if(request.do == "send") {
		        var i=0;
				for (i=0; i<localStorage.length; i++) {
					var item = localStorage.getItem(localStorage.key(i));
					$.ajax({
				    url: sUrl+'/vpost',
				    type: 'POST',
				    data: item,
				    contentType: "application/json; charset=utf-8",
				    success: function(m) { alert($.toJSON(m)); },
				    error: function(m) { alert($.toJSON(m)); }
					});
					localStorage.removeItem(localStorage.key(i));
				}
		    } 
		    if(request.do == "purge") {
		        var i=0;
				for (i=0; i<localStorage.length; i++) {
					localStorage.removeItem(localStorage.key(i));
				}
		    } 
		    if(request.do == "audit") {
		        var i=0;
				for (i=0; i<localStorage.length; i++) {
					alert(localStorage.getItem(localStorage.key(i)));
				}
		    } 
		});
  </script>
 </head>
 
</html>

